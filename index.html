<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>LifeOS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0b1020;
  --panel:#11172a;
  --card:#0e1430;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#38bdf8;
  --ok:#22c55e;
  --danger:#ef4444;
  --radius:14px;
}
.light{
  --bg:#f8fafc;
  --panel:#ffffff;
  --card:#e5e7eb;
  --text:#020617;
  --muted:#475569;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
}
.app{
  max-width:1200px;
  margin:auto;
  padding:12px;
  display:grid;
  grid-template-columns:2.2fr 1fr;
  gap:12px;
}
.panel{
  background:var(--panel);
  border-radius:var(--radius);
  padding:14px;
  overflow:auto;
}
h1,h2{margin:.3em 0}
input,select,textarea,button{
  background:var(--card);
  color:var(--text);
  border:none;
  border-radius:10px;
  padding:8px;
}
button{cursor:pointer}
.alt{background:#1e293b}
.danger{background:var(--danger)}
.task{
  background:var(--card);
  margin:8px 0;
  padding:10px;
  border-radius:12px;
  display:flex;
  gap:8px;
  align-items:flex-start;
}
.task.done{opacity:.5;text-decoration:line-through}
.task.high{border-left:4px solid var(--danger)}
.task.medium{border-left:4px solid #facc15}
.tags{font-size:11px;color:var(--accent)}
.progress{
  height:10px;
  background:#020617;
  border-radius:999px;
  overflow:hidden;
}
.progress div{
  height:100%;
  background:linear-gradient(90deg,var(--accent),var(--ok));
  width:0%;
  transition:.3s;
}
.timer{font-size:34px;text-align:center}
.focus .right{display:none}
small{color:var(--muted)}
</style>
</head>

<body>
<div class="app">

<!-- IZQUIERDA -->
<div class="panel">
<h1>ğŸ§  LifeOS</h1>

<input id="search" placeholder="Buscar tareasâ€¦">

<div style="display:grid;grid-template-columns:2fr 1fr 1fr;gap:6px">
<input id="taskText" placeholder="Nueva tarea (#tags)">
<input type="date" id="taskDate">
<select id="taskPriority">
<option value="low">Baja</option>
<option value="medium">Media</option>
<option value="high">Alta</option>
</select>
</div>

<button onclick="addTask()">â• AÃ±adir</button>
<button class="alt" onclick="undo()">â†© Undo</button>

<div>
<button class="alt" onclick="setFilter('all')">Todas</button>
<button class="alt" onclick="setFilter('todo')">Pendientes</button>
<button class="alt" onclick="setFilter('done')">Hechas</button>
<button class="alt" onclick="setFilter('today')">Hoy</button>
</div>

<ul id="taskList"></ul>
</div>

<!-- DERECHA -->
<div class="panel right">
<h2>ğŸ“ˆ Progreso</h2>
<div class="progress"><div id="bar"></div></div>
<small id="stats"></small>

<h2>â± Pomodoro</h2>
<div class="timer" id="timer">25:00</div>
<button onclick="startPomodoro()">â–¶</button>
<button class="alt" onclick="resetPomodoro()">âŸ³</button>

<h2>ğŸ“ Notas</h2>
<textarea id="notes" rows="6"></textarea>

<button class="alt" onclick="toggleTheme()">ğŸŒ“ Tema</button>
<button class="alt" onclick="toggleFocus()">ğŸ¯ Focus</button>
<button class="danger" onclick="resetAll()">ğŸ—‘ Reset</button>
</div>

</div>

<script>
/* ===== DATA ===== */
let tasks = JSON.parse(localStorage.tasks || "[]");
let history = [];
let filter = "all";

/* ===== NOTES ===== */
notes.value = localStorage.notes || "";
notes.oninput = () => localStorage.notes = notes.value;

/* ===== UNDO ===== */
function snapshot(){
  history.push(JSON.stringify(tasks));
  if(history.length > 30) history.shift();
}
function undo(){
  if(!history.length) return;
  tasks = JSON.parse(history.pop());
  save(); render();
}

/* ===== STORAGE ===== */
function save(){
  localStorage.tasks = JSON.stringify(tasks);
}

/* ===== ADD TASK ===== */
function addTask(){
  if(!taskText.value.trim()) return;
  snapshot();
  const tags = taskText.value.match(/#\w+/g) || [];
  tasks.push({
    id: Date.now(),
    text: taskText.value.replace(/#\w+/g,"").trim(),
    tags,
    date: taskDate.value,
    priority: taskPriority.value,
    done:false
  });
  taskText.value=""; taskDate.value="";
  save(); render();
}

/* ===== MINI IA: PRIORIDAD ===== */
const KEYWORDS = {
  urgente:5, examen:4, entrega:4,
  proyecto:3, estudio:2, trabajo:2
};

function scoreTask(t){
  let s = 0;
  const today = new Date().toISOString().slice(0,10);

  if(t.priority==="high") s+=6;
  if(t.priority==="medium") s+=3;

  if(t.date){
    if(t.date===today) s+=6;
    else s+=2;
  }

  s += Math.min(5,(Date.now()-t.id)/86400000);

  const text=t.text.toLowerCase();
  for(const k in KEYWORDS){
    if(text.includes(k)) s+=KEYWORDS[k];
  }
  return s;
}

function autoPrioritize(){
  tasks.forEach(t=>t._score=scoreTask(t));
  tasks.sort((a,b)=>b._score-a._score);
}

/* ===== RENDER ===== */
function render(){
  autoPrioritize();
  taskList.innerHTML="";
  const q=search.value.toLowerCase();
  const today=new Date().toISOString().slice(0,10);

  tasks.filter(t=>{
    if(filter==="done"&&!t.done) return false;
    if(filter==="todo"&&t.done) return false;
    if(filter==="today"&&t.date!==today) return false;
    if(q&&!t.text.toLowerCase().includes(q)) return false;
    return true;
  }).forEach((t,i)=>{
    const li=document.createElement("li");
    li.className=`task ${t.done?"done":""} ${t.priority}`;
    if(i===0 && !t.done){
      li.style.boxShadow="0 0 0 2px var(--accent)";
      li.title="Recomendado por la IA";
    }

    const c=document.createElement("input");
    c.type="checkbox"; c.checked=t.done;
    c.onchange=()=>{snapshot();t.done=c.checked;save();render();};

    const s=document.createElement("span");
    s.textContent=t.text+(t.date?" ğŸ“…"+t.date:"");
    s.onclick=()=>{
      const n=prompt("Editar tarea",t.text);
      if(n){snapshot();t.text=n;save();render();}
    };

    const d=document.createElement("button");
    d.textContent="âœ–"; d.className="danger";
    d.onclick=()=>{snapshot();tasks=tasks.filter(x=>x.id!==t.id);save();render();};

    li.append(c,s,d);

    if(t.tags.length){
      const tg=document.createElement("div");
      tg.className="tags";
      tg.textContent=t.tags.join(" ");
      li.appendChild(tg);
    }

    taskList.appendChild(li);
  });

  updateProgress();
}

/* ===== PROGRESS ===== */
function updateProgress(){
  const done=tasks.filter(t=>t.done).length;
  stats.textContent=`${done}/${tasks.length} completadas`;
  bar.style.width=(tasks.length?done/tasks.length*100:0)+"%";
}

/* ===== UI ===== */
function setFilter(f){filter=f;render();}
function toggleTheme(){document.body.classList.toggle("light");}
function toggleFocus(){document.body.classList.toggle("focus");}
function resetAll(){if(confirm("Seguro")){tasks=[];save();render();}}

/* ===== POMODORO ===== */
let time=1500,int=null;
function startPomodoro(){
  if(int)return;
  int=setInterval(()=>{
    time--;updateTimer();
    if(time<=0){clearInterval(int);int=null;alert("ğŸ… Fin");}
  },1000);
}
function resetPomodoro(){clearInterval(int);int=null;time=1500;updateTimer();}
function updateTimer(){
  timer.textContent=Math.floor(time/60)+":"+String(time%60).padStart(2,"0");
}

render();updateTimer();
</script>
</body>
</html>
